<!DOCTYPE html>
<html>
<head>
    <meta charset="UTS-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>test</title>
    
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" 
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" 
    crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" 
    crossorigin="anonymous">

    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">

</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" style="font-weight: bold;">10조</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Features</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Pricing</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">Disabled</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <h1 class="text-center mt-3">Sparta Apartment Free Board!</h1>

  <table class="table table-hover table-striped text-center container mt-3">
    <thead class="table-danger">
      <tr>
        <th>번호</th>
        <th>글쓴이</th>
        <th>내용</th>
        <th>삭제</th>
        <th>수정</th>
      </tr>
    </thead>

    <tbody id="comment-list">
      <!-- {% for i in data_list %}
      <tr>
        <td>{{ i[0] }}</td>
        <td>{{ i[1] }}</td>
        <td>{{ i[2] }}</td>
        <td>{{ i[3] }}</td>
      </tr>
      {% endfor %} -->
    </tbody>
  </table>

  <hr class="container">

  <div class="container post-write w-50">
    <form>
      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label mt-3">이름</label>
        <input type="text" class="form-control" aria-describedby="emailHelp" id="name">
      </div>
      <div class="mb-3">
        <label for="exampleInputPassword1" class="form-label">내용</label>
        <input type="text" class="form-control" id="comment">
      </div>
      <div class="col">
        <button onclick="save_comment()" type="button" class="btn btn-primary col-2" >Submit</button>
        <button type="button" class="btn btn-danger col-2 float-end close">Close</button>
      </div>
    </form>
  </div>

  <div class="container post-correction w-75">
    <form>
      <div class="mb-3">
        <input type="text" class="form-control" id="correction-comment" aria-describedby="emailHelp">
        <div id="emailHelp" class="form-text">내용을 수정하세요.</div>
      </div>
      <div class="col">
        <button type="button" class="btn btn-danger float-end correction-close">닫기</button>
      </div>
    </form>
  </div>

  <div>
    <ul class="pagination justify-content-center">
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">◀</a></li>
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">1</a></li>
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">2</a></li>
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">3</a></li>
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">4</a></li>
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">5</a></li>
      <li><a href="#" style="margin-right: 5px;" class="text-secondary">▶</a></li>
    </ul>
  </div>

  <div class="container btn-write">
    <a class="btn btn-outline-dark float-end">글쓰기</a>
  </div>

  <div class="container">
    <a class="btn btn-warning correction-show" style="color: white; font-weight: bold;">글 수정하기</a>
  </div>

  <script>

    $(document).ready(function () {
      reload_comment();
    });

    // GET - 게시글 불러오기
    function reload_comment() {
        $.ajax({
            type: "GET",
            url: "/comment",
            data: {},
            success: function (response) {
                doc = response['data_list']
                for (let i = 0; i < doc.length; i++) {
                    let id = doc[i][0]
                    let name = doc[i][1]
                    let comment = doc[i][2]
                    let 템플릿 = `<tr>
                                  <td>${id}</td>
                                  <td>${name}</td>
                                  <td>${comment}</td>
                                  <td><button type="button" class="btn btn-danger delete" data-id="${id}" style="height: 35px;">삭제</button></td>
                                  <td><button type="button" class="btn btn-warning correction" style="height: 35px;" data-id="${id}">수정</button></td>
                                </tr>`
                    $('#comment-list').append(템플릿)


                    // DELETE - 게시글 삭제하기 --------------------
                    $('.delete').on('click', function(e) {
                      let 글번호 = e.target.dataset.id

                      $.ajax({
                        method : 'DELETE',
                        url : '/delete',
                        data : { id : 글번호 },
                        success: function (response) {
                            alert(response['msg'])
                            window.location.reload()
                        }
                      })
                    })
                    //------------------------------------------


                    // PUT = 게시글 수정하기 =====================
                    $('.correction-show').on('click', () => $('.post-correction').fadeIn(1000) ) // 수정 게시판 show

                    $('.correction-close').on('click', () => $('.post-correction').fadeOut(1000) ) // 수정 게시판 hide

                    $('.correction').on('click', function(e) {
                      let 글번호 = e.target.dataset.id
                      let correction = $('#correction-comment').val()

                      $.ajax({
                        method : 'PUT',
                        url : '/put',
                        data : { id : 글번호, correction_give : correction },
                        success: function (response) {
                            alert(response['msg'])
                            window.location.reload()
                        }
                      })
                    })

                }
            }
        });
    }

    // POST - 게시글 저장하기
    function save_comment() {
      let name = $('#name').val()
      let comment = $('#comment').val()

      $.ajax({
          type: 'POST',
          url: '/save_comment',
          data: {name_give: name, comment_give: comment},
          success: function (response) {
              alert(response['msg'])
              window.location.reload()
          }
      })
    }

    $('.btn-write').on('click', () =>  $('.post-write').fadeIn(1000) )  // 글쓰기 버튼 클릭 시 write창 보여짐

    $('.close').on('click', () => $('.post-write').fadeOut(1000) )  // 닫힘 버튼 클릭 시 write창 사라짐

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" 
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" 
  crossorigin="anonymous"></script>

</body>
</html>